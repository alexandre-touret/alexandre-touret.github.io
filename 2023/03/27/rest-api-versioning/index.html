<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Real life Rest API Versioning for dummies - Alexandre Touret's Blog</title><meta name=Description content="Alexandre Touret's Blog"><meta property="og:url" content="https://blog.touret.info/2023/03/27/rest-api-versioning/">
<meta property="og:site_name" content="Alexandre Touret's Blog"><meta property="og:title" content="Real life Rest API Versioning for dummies"><meta property="og:description" content="1 Once upon a time an API … Second Law of Consulting “No matter how it looks at first, it’s always a people problem” - Gerald M. Weinberg Once upon a time, the ACME Corporation was building a brand new IT product. It aimed at a new software to manage bookstores through a web interface and an API.
In the first steps, the developers drew up a first roadmap of their API based on the expectations of their first customers."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-27T08:00:00+00:00"><meta property="article:modified_time" content="2023-08-31T14:21:02+02:00"><meta property="article:tag" content="REST"><meta property="article:tag" content="API"><meta property="article:tag" content="Versioning"><meta property="og:image" content="https://blog.touret.info/assets/images/2023/03/vardan-papikyan-DnXqvmS0eXM-unsplash.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.touret.info/assets/images/2023/03/vardan-papikyan-DnXqvmS0eXM-unsplash.webp"><meta name=twitter:title content="Real life Rest API Versioning for dummies"><meta name=twitter:description content="1 Once upon a time an API … Second Law of Consulting “No matter how it looks at first, it’s always a people problem” - Gerald M. Weinberg Once upon a time, the ACME Corporation was building a brand new IT product. It aimed at a new software to manage bookstores through a web interface and an API.
In the first steps, the developers drew up a first roadmap of their API based on the expectations of their first customers."><meta name=twitter:site content="@touret_alex"><meta name=application-name content="Alexandre Touret's Blog"><meta name=apple-mobile-web-app-title content="Alexandre Touret's Blog"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><meta name=twitter:creator content="@touret_alex"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://blog.touret.info/2023/03/27/rest-api-versioning/><link rel=prev href=https://blog.touret.info/2023/03/03/migrer-un-site-jekyll-sur-hugo/><link rel=next href=https://blog.touret.info/2023/07/21/fish-shell/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="7UnqNmvO-mjfMkRqKaaWRPTBxSylEVJXvAn8iTfc7SI"><meta name=msvalidate.01 content="F9655A4C8648E42154ECB4B4D6CF60A2"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Real life Rest API Versioning for dummies","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.touret.info/2023/03/27/rest-api-versioning/"},"image":["https://blog.touret.info/images/alexandre.touret.webp"],"genre":"posts","keywords":"REST, API, Versioning","wordcount":2107,"url":"https://blog.touret.info/2023/03/27/rest-api-versioning/","datePublished":"2023-03-27T08:00:00+00:00","dateModified":"2023-08-31T14:21:02+02:00","license":"This work is licensed under a Creative Commons Attribution 4.0 International License.","publisher":{"@type":"Organization","name":"Alexandre Touret","logo":"https://blog.touret.info/images/alexandre.touret.webp"},"author":{"@type":"Person","name":"Alexandre Touret"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"auto"==="light"||"auto"==="dark"||"auto"==="black"?(setTheme("auto"),saveTheme("auto")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Alexandre Touret's Blog"><span id=desktop-header-typeit class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/contact/>Contact </a><a class=menu-item href=/talks/>Talks </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i>
</span></span><a href=javascript:void(0); class="menu-item theme-select" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-desktop title="Switch Theme"><option value=light>Light</option><option value=dark>Dark</option><option value=black>Black</option><option value=auto>Auto</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Alexandre Touret's Blog"><span id=mobile-header-typeit class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/contact/ title>Contact</a><a class=menu-item href=/talks/ title>Talks</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-select" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-mobile title="Switch Theme"><option value=light>Light</option><option value=dark>Dark</option><option value=black>Black</option><option value=auto>Auto</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#once-upon-a-time-an-api->Once upon a time an API &mldr;</a></li><li><a href=#the-platform-and-its-roadmap>The platform and its roadmap</a></li><li><a href=#what-to-version-how-and-where-to-apply-it>What to version? How and where to apply it?</a><ul><li><a href=#how-many-versions-must-i-handle>How many versions must I handle?</a></li><li><a href=#where>Where?</a></li><li><a href=#how-to-define-it>How to define it?</a></li></ul></li><li><a href=#what-about-the-main-softwarecloud-providers>What about the main software/cloud providers?</a><ul><li><a href=#google>Google</a></li><li><a href=#spotify>Spotify</a></li><li><a href=#apple>Apple</a></li></ul></li><li><a href=#appropriate-or-not-technologies>Appropriate (or not) technologies</a></li><li><a href=#configuration-management--delivery-automation>Configuration management & delivery automation</a><ul><li><a href=#source-code-configuration>Source code configuration</a></li><li><a href=#delivery-process>Delivery process</a></li></ul></li><li><a href=#authorisation-management>Authorisation management</a></li><li><a href=#and-now-something-completely-different-how-to-avoid-versioning-while-evolving-your-api>And now something completely different: How to avoid versioning while evolving your API?</a></li><li><a href=#wrap-up>Wrap-up</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Real life Rest API Versioning for dummies</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=https://blog.touret.info title=Author target=_blank rel="noopener noreferrer author" class=author>Alexandre Touret</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-03-27>2023-03-27</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2023-08-31>2023-08-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2107 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;10 minutes&nbsp;</div></div><div class=featured-image><img loading=eager src=/assets/images/2023/03/vardan-papikyan-DnXqvmS0eXM-unsplash.webp srcset="/assets/images/2023/03/vardan-papikyan-DnXqvmS0eXM-unsplash.webp, /assets/images/2023/03/vardan-papikyan-DnXqvmS0eXM-unsplash.webp 1.5x, /assets/images/2023/03/vardan-papikyan-DnXqvmS0eXM-unsplash.webp 2x" title=/assets/images/2023/03/vardan-papikyan-DnXqvmS0eXM-unsplash.webp></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#once-upon-a-time-an-api->Once upon a time an API &mldr;</a></li><li><a href=#the-platform-and-its-roadmap>The platform and its roadmap</a></li><li><a href=#what-to-version-how-and-where-to-apply-it>What to version? How and where to apply it?</a><ul><li><a href=#how-many-versions-must-i-handle>How many versions must I handle?</a></li><li><a href=#where>Where?</a></li><li><a href=#how-to-define-it>How to define it?</a></li></ul></li><li><a href=#what-about-the-main-softwarecloud-providers>What about the main software/cloud providers?</a><ul><li><a href=#google>Google</a></li><li><a href=#spotify>Spotify</a></li><li><a href=#apple>Apple</a></li></ul></li><li><a href=#appropriate-or-not-technologies>Appropriate (or not) technologies</a></li><li><a href=#configuration-management--delivery-automation>Configuration management & delivery automation</a><ul><li><a href=#source-code-configuration>Source code configuration</a></li><li><a href=#delivery-process>Delivery process</a></li></ul></li><li><a href=#authorisation-management>Authorisation management</a></li><li><a href=#and-now-something-completely-different-how-to-avoid-versioning-while-evolving-your-api>And now something completely different: How to avoid versioning while evolving your API?</a></li><li><a href=#wrap-up>Wrap-up</a></li></ul></nav></div></div><div class=content id=content><h2 id=once-upon-a-time-an-api- class=headerLink><a href=#once-upon-a-time-an-api- class=header-mark></a>1 Once upon a time an API &mldr;</h2><div class="details admonition quote open"><div class="details-summary admonition-title"><i class="icon fas fa-quote-right fa-fw"></i>Second Law of Consulting<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content><em>“No matter how it looks at first, it’s always a people problem” - Gerald M. Weinberg</em></div></div></div><p>Once upon a time, the <a href=https://en.wikipedia.org/wiki/Acme_Corporation target=_blank rel="noopener noreferrer">ACME Corporation</a> was building a brand new IT product.
It aimed at a new software to manage bookstores through a web interface and an API.</p><p>In the first steps, the developers drew up a first roadmap of their API based on the expectations of their first customers.
They therefore built and shipped a microservices platform and released their first service contract for their early adopters.</p><p>Here is the design of this platform:</p><p><strong>The High level design</strong></p><div id=id-1><figure><img loading=lazy src=/assets/images/2023/03/Bookstore-System_Context_diagram_for_Bookstore_System.svg srcset="/assets/images/2023/03/Bookstore-System_Context_diagram_for_Bookstore_System.svg, /assets/images/2023/03/Bookstore-System_Context_diagram_for_Bookstore_System.svg 1.5x, /assets/images/2023/03/Bookstore-System_Context_diagram_for_Bookstore_System.svg 2x" title="c4 context diagram"></figure></div><p><strong>More in depth</strong></p><div id=id-2><figure><img loading=lazy src=/assets/images/2023/03/Bookstore-Container_Context_diagram_for_Bookstore_System.svg srcset="/assets/images/2023/03/Bookstore-Container_Context_diagram_for_Bookstore_System.svg, /assets/images/2023/03/Bookstore-Container_Context_diagram_for_Bookstore_System.svg 1.5x, /assets/images/2023/03/Bookstore-Container_Context_diagram_for_Bookstore_System.svg 2x" title="c4 container diagram"></figure></div><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>To sum up<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>To cut long story short, we have a microservices platform based on the <a href=https://docs.spring.io/spring-boot/docs/ target=_blank rel="noopener noreferrer">Spring Boot</a>/<a href=https://docs.spring.io/spring-boot/docs/ target=_blank rel="noopener noreferrer">Cloud</a> Stack exposed through an <a href=https://spring.io/projects/spring-cloud-gateway target=_blank rel="noopener noreferrer">API Gateway</a> and <a href=https://github.com/spring-projects/spring-authorization-server/ target=_blank rel="noopener noreferrer">secured</a> using <a href=https://openid.net/ target=_blank rel="noopener noreferrer">OpenID Connect</a>.</div></div></div><h2 id=the-platform-and-its-roadmap class=headerLink><a href=#the-platform-and-its-roadmap class=header-mark></a>2 The platform and its roadmap</h2><p>After shipping it into production, they drew up a roadmap for their existing customers to both improve the existing features and bring new ones.</p><p>As of now, we could think everything is <em>hunky-dory</em> isn&rsquo;t it?</p><p>While engineers worked on improving the existing API, the sales representative have contracted with new customers.
They enjoyed this product and its functionalities.
However, they also ask for new requirements and concerns.</p><p>Some of them are easy to apply, some not.
For instance, a new customer asked the <a href=https://en.wikipedia.org/wiki/Acme_Corporation target=_blank rel="noopener noreferrer">ACME engineers</a> for getting a <code>summary</code> for every book and additional REST operations.</p><p><em>Easy!</em></p><p>However, last but not least, this customer would also get a list of authors for every book whereas the existing application only provides ONE author per book.</p><div id=id-3><p><figure><img loading=lazy src=/assets/images/2023/03/breaking_change.webp srcset="/assets/images/2023/03/breaking_change.webp, /assets/images/2023/03/breaking_change.webp 1.5x, /assets/images/2023/03/breaking_change.webp 2x" title="Breaking change"></figure></p><p><strong>This is a breaking change!</strong></p></div><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>What is a breaking change?<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content><p>A breaking change occurs when the backward compatibility is broken between two following versions.</p><p>For instance, when you completely change the service contract on your API, a client which uses the old API definition is unable to use your new one.</p></div></div></div><p>A common <em>theoretical</em> approach could be to apply versions on our APIs and adapt it according to the customer.</p><p>Unfortunately, the devil is in the details.</p><p>I will describe in this article attention points I struggled with in my last projects.</p><h2 id=what-to-version-how-and-where-to-apply-it class=headerLink><a href=#what-to-version-how-and-where-to-apply-it class=header-mark></a>3 What to version? How and where to apply it?</h2><p>After answering to the first question: <em>Do I really need API versioning?</em> you then have to answer to this new one: what should we consider versioning?</p><p><strong>You only have to version the service contract.</strong></p><p>In the case of a simple web application based on a GUI and an API</p><div id=id-4><figure><img loading=lazy src=/assets/images/2023/03/monolith-Donuts___Home_Monolith.svg srcset="/assets/images/2023/03/monolith-Donuts___Home_Monolith.svg, /assets/images/2023/03/monolith-Donuts___Home_Monolith.svg 1.5x, /assets/images/2023/03/monolith-Donuts___Home_Monolith.svg 2x" title="c4 monolith"></figure></div><p>Versioning is applied in the service contract of your API.
If you change your database without impacting the APIs, why should you waste your time creating and managing a version of your API?
It doesn&rsquo;t make sense.</p><p>On the other way around, when you evolve your service contract, you usually impact your database (e.g., see the example of breaking change above).</p><p>Moreover, the version <strong>is usually specified on the <em>&ldquo;middleware&rdquo;</em> side, where your expose your API</strong>.
I&rsquo;ll come back to this point in a later section.</p><p>If you want to dig into what is a breaking change and what to version, you can read <a href="https://docs.github.com/en/rest/overview/api-versions?apiVersion=2022-11-28" target=_blank rel="noopener noreferrer">this guide on the GitHub website</a>.</p><h3 id=how-many-versions-must-i-handle class=headerLink><a href=#how-many-versions-must-i-handle class=header-mark></a>3.1 How many versions must I handle?</h3><p>Tough question!</p><p>Throughout my different experiences struggling with API versioning, the most acceptable trade-off for both the API provider and customer/client was to only handle two versions: the current and the deprecated one.</p><h3 id=where class=headerLink><a href=#where class=header-mark></a>3.2 Where?</h3><p>Now, you have to answer to this question: Where should I handle the version?</p><ul><li>On the Gateway?</li><li>On Every Backend?</li><li>On every service or on every set of services?</li><li>Directly in the code managed by different packages.</li></ul><p>Usually, I prefer manage it on the gateway side and don&rsquo;t bother with URL management on every backend.
It could avoid maintenance on both code and tests for every release.
However, you can&rsquo;t have this approach on monolithic applications (see below).</p><h3 id=how-to-define-it class=headerLink><a href=#how-to-define-it class=header-mark></a>3.3 How to define it?</h3><p>Here are three ways to define API versions:</p><ul><li>In the URL (e.g., <code>/v1/api/books</code>)</li><li>In a HTTP header (e.g., <code>X-API-VERSION: v1</code>)</li><li>In the content type (e.g., <code>Accept: application/vnd.myname.v1+json</code>)</li></ul><p>The last one is now deprecated.
<a href=https://www.rfc-editor.org/rfc/rfc9110.html#name-accept target=_blank rel="noopener noreferrer">The RFC 9110 deprecates now <em>custom</em> usages of the <code>accept</code> HTTP header</a>.</p><p>I strongly prefer the first one. It is the most straightforward.</p><p>For instance, if you provide your books API first version, you can declare this URL in your OpenAPI specification:<code>/v1/api/books</code>.
The version declared here is pretty clear and difficult to miss.</p><p>If you specify the version in a HTTP header, it&rsquo;s less clear.
If you have this URL <code>/api/books</code> and the version specified in this header: <code>X-API-VERSION: v1</code>, what would be the version called (or not) if you didn&rsquo;t specify the header? Is there any default version?
Yes, you can read the documentation to answer these questions, but who (really) does?</p><p>The version declared here is pretty clear and difficult to miss.
If you specify the version in a HTTP header, it&rsquo;s less clear.
If you have this URL <code>/api/books</code> and the version specified in this header: <code>X-API-VERSION: v1</code>, what would be the version called (or not) if you didn&rsquo;t specify the header? Is there any default version?</p><p>Yes, you can read the documentation, but who (really) does?</p><p>The first solution (i.e., version in the URL) mandatorily conveys the associated version.
It is so visible for all the stakeholders and could potentially avoir any mistakes or headaches while debugging.</p><h2 id=what-about-the-main-softwarecloud-providers class=headerLink><a href=#what-about-the-main-softwarecloud-providers class=header-mark></a>4 What about the main software/cloud providers?</h2><p>Before reinventing the wheel, let&rsquo;s see how the main actors of our industry deal with this topic.
I looked around and found three examples:</p><h3 id=google class=headerLink><a href=#google class=header-mark></a>4.1 Google</h3><ul><li>The version is specified in the URL</li><li>It only represents the major versions which handle breaking changes</li></ul><h3 id=spotify class=headerLink><a href=#spotify class=header-mark></a>4.2 Spotify</h3><ul><li>The version is specified in the URL</li><li>The API version is still <code>V1</code> &mldr;</li></ul><h3 id=apple class=headerLink><a href=#apple class=header-mark></a>4.3 Apple</h3><ul><li>The version is specified in the URL</li><li>The API version is still <code>V1</code> &mldr;</li></ul><h2 id=appropriate-or-not-technologies class=headerLink><a href=#appropriate-or-not-technologies class=header-mark></a>5 Appropriate (or not) technologies</h2><p>In my opinion, technologies based on the <a href=https://microservices.io/patterns/monolithic.html target=_blank rel="noopener noreferrer">monolith pattern</a> don&rsquo;t fit handling <em>properly</em> API Versioning.
If you are not eager to execute two versions of your <a href=https://microservices.io/patterns/monolithic.html target=_blank rel="noopener noreferrer">monolith</a>, you would have to provide both of the two versions within the same app and runtime.</p><p>You see the point?</p><p>You would therefore struggle with:</p><ul><li>packaging</li><li>testing both of two releases for every deployment even if a new feature doesn&rsquo;t impact the deprecated version</li><li>removing, add new releases in the same source code,&mldr; And loosing your mind.</li></ul><p>In my opinion, best associated technologies are more modular whether during the development or deployment phases.</p><p>For instance, if you built your app with Container based (Docker, Podman, K8S,..) stack, you would easily switch from one version to another, and sometimes you would be able to ship new features without impacting the oldest version.</p><p>However, we need to set up our development and integration workflow to do that.</p><h2 id=configuration-management--delivery-automation class=headerLink><a href=#configuration-management--delivery-automation class=header-mark></a>6 Configuration management & delivery automation</h2><p>When I dug into API versioning, I realised it impacts projects organisation and, by this way, the following items:</p><ul><li>The source code management: <em>one version per branch or not?</em></li><li>The release process: <em>How to create releases properly?</em></li><li>Fixes, merges,&mldr;: <em>How to apply fixes among branches and versions?</em></li><li>The delivery process: <em>How to ship you versions?</em></li></ul><p>Yes <strong>it IS a big deal</strong></p><p>Here is <em>the least bad</em> approach I think it works while addressing all of these concerns:</p><h3 id=source-code-configuration class=headerLink><a href=#source-code-configuration class=header-mark></a>6.1 Source code configuration</h3><p>When you want to have two different versions in production, you must decouple your work in several GIT (what else) branches.</p><p>For that, I usually put in place <a href=https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow target=_blank rel="noopener noreferrer">GitFlow</a>.</p><figure><img src=/assets/images/2023/03/gitflow.svg><figcaption><h4>source: Atlassian</h4></figcaption></figure><p>Usually, using this workflow, we consider the <code>develop</code> branch serves as an integration branch.
But, now we have two separate versions?
Yes, but don&rsquo;t forget we have a <strong>current</strong> version and a <strong>deprecated one</strong>.</p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>SemVer<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>I base my versioning naming and numbers on <a href=https://semver.org/ target=_blank rel="noopener noreferrer">SemVer</a></div></div></div><p>To handle API versions, we can use <a href=https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow target=_blank rel="noopener noreferrer"><code>release</code> branches</a>.</p><p>You can easily declare versions regarding your API versions.</p><p>For instance:</p><ul><li><code>release/book-api-1.0.1</code></li><li><code>release/book-api-2.0.1</code></li></ul><p>We can so have the following workflow:</p><ol><li>Develop features in feature branches and merge them into the <code>develop</code> branch.</li><li>Release and use major release numbers (or whatever) to identify breaking changes and your API version number</li><li>Create binaries (see below) regarding the tags and release branches created</li><li>Fix existing branches when you want to backport features brought by new features (e.g., when there is an impact on the database mapping), and release them using minor version numbers</li><li>Apply fixes and create releases</li></ol><h3 id=delivery-process class=headerLink><a href=#delivery-process class=header-mark></a>6.2 Delivery process</h3><p>As of now, we saw how to design, create and handle versions.</p><p>But, how to ship them?</p><p>If you based your source code management on top of GitFlow, you would be able now to deliver releases available from git tags and release branches.
The good point is you can indeed build your binaries on top of these.
The bad one, is you must design and automatise this whole process in a CI/CD pipeline.</p><p>Don&rsquo;t forget to share it to all the stakeholders, whether developers, integrators or project leaders who are often involved in version definition.</p><p><em>Hold on, these programs must be executed against a configuration, aren&rsquo;t they?</em></p><p>Nowadays, if we respect the <a href=https://12factor.net/ target=_blank rel="noopener noreferrer">12 factors</a> during our design and implementation, the configuration is provided through environment variables.</p><p>To cut long story short, your API versioning will also impact your configuration.
Thus, it becomes mandatory to externalise it and version it.</p><p>You can do it in different ways.</p><p>You can, for example, deploy a configuration server.
It will provide configuration key/values regarding the version.
If you want a live example, you can <a href=https://github.com/alexandre-touret/rest-apis-versioning-solution target=_blank rel="noopener noreferrer">get an example in a workshop I held this year at SnowcampIO</a>.
The configuration is managed by <a href=https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#_quick_start target=_blank rel="noopener noreferrer">Spring Cloud Config</a>.</p><p>You can also handle your configuration in your Helm Charts if you deploy your app on top of Kubernetes.
Your configuration values will be injected directly during the deployment.
Obviously if it&rsquo;s a monolith, it will be strongly difficult.</p><p>Why?</p><p>Because you will lose flexibility on version management and the capacity on deploying several versions of your service.</p><h2 id=authorisation-management class=headerLink><a href=#authorisation-management class=header-mark></a>7 Authorisation management</h2><p>Here is another point to potentially address when we implement API versioning.
When you apply an authorisation mechanism on your APIs using <a href=https://oauth.net/2/ target=_blank rel="noopener noreferrer">OAuthv2</a> or <a href=https://openid.net/ target=_blank rel="noopener noreferrer">OpenID Connect</a>, you would potentially have strong differences in your authorisation policies between two major releases.</p><p>You would then restrict the usage of a version to specific <a href=https://openid.net/specs/openid-connect-core-1_0.html#Terminology target=_blank rel="noopener noreferrer">clients or end users</a>.
One way to handle this is to use <a href=https://openid.net/specs/openid-connect-core-1_0.html#ScopeClaims target=_blank rel="noopener noreferrer">scopes</a> stored in claims.</p><p>In the use case we have been digging into, we can declare scopes such as: <code>book:v1:write</code> or <code>number:v2:read</code> to specify both the authorised action and the corresponding version.</p><p>For example, here is a request to get an <a href=https://oauth.net/2/access-tokens target=_blank rel="noopener noreferrer">access_token</a> from the v1 scopes:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>http --form post :8009/oauth2/token <span class=nv>grant_type</span><span class=o>=</span><span class=s2>&#34;client_credentials&#34;</span> <span class=nv>client_id</span><span class=o>=</span><span class=s2>&#34;customer1&#34;</span> <span class=nv>client_secret</span><span class=o>=</span><span class=s2>&#34;secret1&#34;</span> <span class=nv>scope</span><span class=o>=</span><span class=s2>&#34;openid book:v1:write book:v1:write number:v1:read&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>And the response could be:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;access_token&#34;</span>: <span class=s2>&#34;eyJraWQiOiIxNTk4NjZlMC0zNWRjLTQ5MDMtYmQ5MC1hMTM5ZDdjMmYyZjciLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJjdXN0b21lcjIiLCJhdWQiOiJjdXN0b21lcjIiLCJuYmYiOjE2NzI1MDQ0MTQsInNjb3BlIjpbImJvb2t2Mjp3cml0ZSIsIm51bWJlcnYyOnJlYWQiLCJvcGVuaWQiLCJib29rdjI6cmVhZCJdLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwMDkiLCJleHAiOjE2Nz
</span></span></span><span class=line><span class=cl><span class=s2>I1MDQ3MTQsImlhdCI6MTY3MjUwNDQxNH0.gAaDcOaORse0NPIauMVK_rhFATqdKCTvLl41HSr2y80JEj_EHN9bSO5kg2pgkz6KIiauFQ6CT1NJPUlqWO8jc8-e5rMjwWuscRb8flBeQNs4-AkJjbevJeCoQoCi_bewuJy7Y7jqOXiGxglgMBk-0pr5Lt85dkepRaBSSg9vgVnF_X6fyRjXVSXNIDJh7DQcQQ-Li0z5EkeHUIUcXByh19IfiFuw-HmMYXu9EzeewofYj9Gsb_7qI0Ubo2x7y6W2tvzmr2PxkyWbmoioZdY9K0
</span></span></span><span class=line><span class=cl><span class=s2>nP6btskFz2hLjkL_aS9fHJnhS6DS8Sz1J_t95SRUtUrBN8VjA6M-ofbYUi5Pb97Q&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;expires_in&#34;</span>: 299,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;scope&#34;</span>: <span class=s2>&#34;book:v1:write number:v1:read openid book:v1:read&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;token_type&#34;</span>: <span class=s2>&#34;Bearer&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Next, you must validate every API call with the version exposed by your API gateway and the requested scope.
When a client tries to reach an API version with inappropriate scopes (e.g., using <code>book:v1:read</code> scope for a client which only uses the v2).</p><p>You will throw this error:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;invalid_scope&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=and-now-something-completely-different-how-to-avoid-versioning-while-evolving-your-api class=headerLink><a href=#and-now-something-completely-different-how-to-avoid-versioning-while-evolving-your-api class=header-mark></a>8 And now something completely different: How to avoid versioning while evolving your API?</h2><p>You probably understood that versioning is totally cumbersome.</p><p>Before putting in place all of these practices, there&rsquo;s another way to add functionalities on a NON-versioned API without impacting your existing customers.</p><p><strong>You can add new resources, operations and data without impacting your existing users.</strong>
{: .notice&ndash;warning}</p><p>With the help of serialization rules, your users would only use the data and operations they know and are confident with.
You will therefore bring backward compatibility to your API.</p><p>Just in case, you can anticipate API versioning by declaring a <code>V1</code> prefix on your API URL and stick to it while it&rsquo;s not mandatory to upgrade it.
That&rsquo;s how and why Spotify and Apple (see above) still stick to the <code>V1</code>.</p><h2 id=wrap-up class=headerLink><a href=#wrap-up class=header-mark></a>9 Wrap-up</h2><p>You probably understood when getting into this topic that API versioning is a project management issue with consequences that requires tackling difficult technical ones.
To sum up, you need to ask yourself these questions:</p><ul><li>Do I need it?</li><li>Can I postpone API versioning by dealing with serialisation rules and just adding new data or operations?</li><li>Is my architecture design compatible?</li><li>Are my source code management and delivery practices compatible?</li></ul><p>After coping with all these points, if you must implement API versioning, you would need to onboard all the different stakeholders, not just developers, to be sure your whole development and delivery process is well aligned with practice.</p><p>And I forgot: <em>Good luck!</em></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-08-31&nbsp;<a class=git-hash href=https://github.com/alexandre-touret/alexandre-touret.github.io/commit/3feadd2709ad6f0e032883003e444f6a9b29dd9d target=_blank title="commit by Alexandre Touret(alexandre-touret@users.noreply.github.com) 3feadd2709ad6f0e032883003e444f6a9b29dd9d: feat: chapter opentelemetry" rel="noopener noreferrer">
<i class="fas fa-hashtag fa-fw"></i>3feadd2</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/2023/03/27/rest-api-versioning/index.md target=_blank rel="noopener noreferrer">Read markdown</a>
</span><span>|&nbsp;<a class=link-to-source href=https://github.com/alexandre-touret/alexandre-touret.github.io/blob/main/exampleSite/content/posts/rest-api-versioning.en.md target=_blank rel="noopener noreferrer">View source</a>
</span><span>|&nbsp;<a class=link-to-report href="https://github.com/alexandre-touret/alexandre-touret.github.io/issues/new?title=[bug]%20Real+life+Rest+API+Versioning+for+dummies&body=|Field|Value|%0A|-|-|%0A|Title|Real+life+Rest+API+Versioning+for+dummies|%0A|Url|https://blog.touret.info/2023/03/27/rest-api-versioning/|%0A|Filename|https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts/rest-api-versioning.en.md|" target=_blank rel="noopener noreferrer">Report issue</a></span></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/rest/>REST</a>,&nbsp;<a href=/tags/api/>API</a>,&nbsp;<a href=/tags/versioning/>Versioning</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2023/03/03/migrer-un-site-jekyll-sur-hugo/ class=prev rel=prev title="Migrer un site Jekyll sur Hugo"><i class="fas fa-angle-left fa-fw"></i>Migrer un site Jekyll sur Hugo</a>
<a href=/2023/07/21/fish-shell/ class=next rel=next title="Moving on to Fish shell (and beyond)">Moving on to Fish shell (and beyond)<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.131.0">Hugo</a>&nbsp;|&nbsp;Theme - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://blog.touret.info target=_blank rel="noopener noreferrer">Alexandre Touret</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by/4.0/ target=_blank>CC BY 4.0</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"",lightTheme:"github-light",repo:"alexandre-touret/alexandre-touret.github.io"}},data:{"desktop-header-typeit":"blog.touret.info","mobile-header-typeit":"blog.touret.info"},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!0,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"No results found",snippetLength:300,threshold:.1,type:"fuse",useExtendedSearch:!1},table:{sort:!0},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},duration:-1,speed:100}}</script><script type=text/javascript src=/lib/tablesort/tablesort.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=/js/utterances.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F1EK89MHJD",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-F1EK89MHJD" async></script></div></body></html>