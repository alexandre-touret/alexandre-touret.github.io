<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>k8s - Tag - Alexandre Touret's Blog</title><link>https://blog.touret.info/tags/k8s/</link><description>k8s - Tag - Alexandre Touret's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>This work is licensed under a Creative Commons Attribution 4.0 International License.</copyright><lastBuildDate>Thu, 08 Oct 2020 10:09:59 +0200</lastBuildDate><atom:link href="https://blog.touret.info/tags/k8s/" rel="self" type="application/rss+xml"/><item><title>K8S, HELM et Cie: au del√† de la hype</title><link>https://blog.touret.info/2020/10/08/k8s-helm-et-cie-au-dela-de-la-hype/</link><pubDate>Thu, 08 Oct 2020 10:09:59 +0200</pubDate><author><name>Alexandre Touret</name></author><guid>https://blog.touret.info/2020/10/08/k8s-helm-et-cie-au-dela-de-la-hype/</guid><description><![CDATA[<div class="featured-image">
                <img src="/assets/images/2020/10/gartner_hype_cycle.svg_.png" referrerpolicy="no-referrer">
            </div><p>Depuis quelques ann√©es, <a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes</a> (K8S) et <a href="https://www.cncf.io/" target="_blank" rel="noopener noreferrer">son √©cosyst√®me</a> deviennent l&rsquo;environnement d&rsquo; ex√©cution √† la mode. Certaines personnes veulent d√©ployer sur cet environnement en mettant en avant ses capacit√©s de scalabilit√©. D&rsquo;autres font du bashing (souvent) justifi√© sur la complexit√© et le co√ªt de mise en ≈ìuvre d&rsquo;une telle plateforme.<br>
Vous l&rsquo;aurez compris, cette technologie n&rsquo;√©chappe pas <a href="https://fr.wikipedia.org/wiki/Cycle_du_hype" target="_blank" rel="noopener noreferrer">au cycle du hype</a> et √† la fameuse courbe du Gartner.</p>
<div id="id-1"><figure><img
        
        loading="lazy"
        src="/assets/images/2020/10/gartner_hype_cycle.svg_.png"
        srcset="/assets/images/2020/10/gartner_hype_cycle.svg_.png, /assets/images/2020/10/gartner_hype_cycle.svg_.png 1.5x, /assets/images/2020/10/gartner_hype_cycle.svg_.png 2x"
        sizes="auto"
        alt="cycle hype"
        title="cycle hype" ></figure></div>
<p>Apr√®s quelques exp√©riences sur cette plateforme ( et beaucoup sur d&rsquo;autres üòÄ ) je vais essayer de peser le pour et le contre qui m&rsquo;apparaissent importants.<br>
Bien √©videmment, ce n&rsquo;est que mon avis, j&rsquo;ai sans doute omis certaines informations qui pourraient √™tre indispensables pour d&rsquo; autres.</p>
<h2 id="pourquoi-et-dans-quelles-conditions-il-ne-faut-pas-utiliser-k8s-" class="headerLink">
    <a href="#pourquoi-et-dans-quelles-conditions-il-ne-faut-pas-utiliser-k8s-" class="header-mark"></a>1 Pourquoi et dans quelles conditions il ne faut pas utiliser K8S ?</h2><p>Avant de pr√©senter les avantages des applications cloud, je vais essayer de r√©aliser l&rsquo;anti th√®se de mon propos.</p>
<h3 id="en-avez-vous-vraiment-besoin-" class="headerLink">
    <a href="#en-avez-vous-vraiment-besoin-" class="header-mark"></a>1.1 En avez vous (vraiment) besoin ?</h3><p>Vaste sujet et question d√©licate pour la population informaticienne qui a tendance √† suivre les tendances du march√©.</p>
<figure><img src="/assets/images/2020/10/aaron-blanco-tejedor-vbe9zj-jhbs-unsplash.png" width="50%"/><figcaption>
            <h4>Cycle Hype</h4>
        </figcaption>
</figure>

<p>Avant de foncer t√™te baiss√©e dans cette technologie qui est tr√®s int√©ressante au demeurant, il est important de se poser ces quelques questions:</p>
<ul>
<li>Est-ce que mes <a href="https://fr.wikipedia.org/wiki/Service-level_objectives" target="_blank" rel="noopener noreferrer">SLO</a> sont contraignantes?</li>
<li>Quel le cycle de d√©ploiement de mes applications?</li>
<li>Qui g√®re les environnements ?</li>
</ul>
<p>Bref, il faut savoir si le jeu en vaut la chandelle. Si vous avez une application qui doit scaler dynamiquement, encaisser les pics, et avoir du <a href="https://dzone.com/articles/zero-downtime-deployment" target="_blank" rel="noopener noreferrer">zero downtime durant les mises √† jour</a>, Kubernetes est fait pour vous. Si vous avez une application de gestion qui n&rsquo;a pas d&rsquo;exigences fortes si ce n&rsquo;est de r√©pondre aux besoins fonctionnels, l&rsquo;utilisation de Kubernetes est discutable.</p>
<h3 id="√™tes-vous-taill√©-pour-" class="headerLink">
    <a href="#%c3%aates-vous-taill%c3%a9-pour-" class="header-mark"></a>1.2 √ätes vous taill√© pour ?</h3><p>Kubernetes et son √©cosyst√®me peuvent s&rsquo;av√©rer complexes √† appr√©hender. Si votre entreprise opte pour une utilisation ¬´¬†<a href="https://en.wikipedia.org/wiki/On-premises_software" target="_blank" rel="noopener noreferrer">on premise</a>¬´¬†, c&rsquo;est pire. Vous devrez avoir une √©quipe d√©di√©e qui g√©rera cette plateforme et offrir une expertise aux √©quipes de d√©veloppement.<br>
Ne vous trompez pas. Si votre r√¥le est de d√©velopper des applications m√©tier, il vous sera tr√®s difficile d&rsquo;avoir √©galement une expertise sur l&rsquo;administration de cette plateforme. Vous pourrez l&rsquo;utiliser et √™tre √† l&rsquo;aise, mais l&rsquo;administration d&rsquo;une telle technologie est tr√®s compliqu√©e.</p>
<p>Le seul conseil que je pourrais vous donner, c&rsquo;est de ne partir sur Kubernetes que si vous avez une <strong>√©quipe support √† disposition</strong>. C&rsquo;est vrai si vous utilisez des services du Cloud tels que Google Cloud ou AWS. √áa l&rsquo;est encore plus si vous utilisez des services ¬´¬†on premise¬†¬ª tels qu&rsquo; Openshift.</p>
<h3 id="est-ce-que-vos-d√©veloppements-sont-cloud-nativehttpswwwredhatcomfrtopicscloud-native-apps-" class="headerLink">
    <a href="#est-ce-que-vos-d%c3%a9veloppements-sont-cloud-nativehttpswwwredhatcomfrtopicscloud-native-apps-" class="header-mark"></a>1.3 Est-ce que vos d√©veloppements sont <a href="https://www.redhat.com/fr/topics/cloud-native-apps" target="_blank" rel="noopener noreferrer">¬´¬†cloud native¬†¬ª</a> ?</h3><p>Au del√† de la plateforme, vous devrez monter en comp√©tence sur le d√©veloppement et la conception de vos applications.</p>
<p>Il vous faudra prendre en consid√©ration <a href="https://en.wikipedia.org/wiki/Twelve-Factor_App_methodology" target="_blank" rel="noopener noreferrer">les 12 facteurs cl√©s</a> dans vos applications. Il n&rsquo;est pas forc√©ment la peine de passer sur des microservices. Il est √©galement possible de faire des monolithes modulaires qui peuvent √™tre l√©gers et stateless. Beaucoup de ces facteurs sont commun√©ment admis comme des bonnes pratiques de d√©veloppement logiciel (ex. Il faut une int√©gration continue).</p>
<p>Aussi, cela va sans dire, il faut √©galement monter (r√©ellement) en comp√©tence sur les conteneurs et leurs contraintes. Si vous n&rsquo;avez pas l&rsquo;habitude de travailler avec des conteneurs ( construction, d√©ploiement, disponibilit√© d&rsquo;une <a href="https://docs.docker.com/registry/" target="_blank" rel="noopener noreferrer">registry</a>). Il est pr√©f√©rable de d√©finir une trajectoire avec des √©tapes interm√©diaires.</p>
<p>Bref, tous ces sujets doivent √™tre adress√©s et compris pour toutes les parties prenantes de vos √©quipes que √ßa soit les d√©veloppeurs, les chefs de projet et les √©quipes m√©tiers √† une moindre mesure. Cette technologie repr√©sente r√©ellement un grand pas √† franchir. Si vous ne vous sentez pas de le faire, ou si vous devez gagner en maturit√© sur ces sujets, attendez avant de vous lancer sur Kubernetes.</p>
<p>On ne pourra jamais vous reprocher de ne pas opter sur Kubernetes si vous ne remplissez pas tous les pr√©-requis. Pour ce qui est du contraire‚Ä¶</p>
<h3 id="avez-vous-des-interactions-avec-des-services-tiers-qui-sont-compatible-avec-kubernetes-" class="headerLink">
    <a href="#avez-vous-des-interactions-avec-des-services-tiers-qui-sont-compatible-avec-kubernetes-" class="header-mark"></a>1.4 Avez vous des interactions avec des services tiers qui sont compatible avec Kubernetes ?</h3><p>Quand vous restez dans votre cluster Kubernetes, g√©n√©ralement, tout va bien. D√®s que vous avez des interactions avec des services tiers, √ßa peut se compliquer.<br>
En effet, g√©n√©ralement vous devrez vous connecter √† des services tiers qui ne sont pas orient√© cloud : <a href="https://en.wikipedia.org/wiki/Hardware_security_module" target="_blank" rel="noopener noreferrer">des boitiers crypto</a>, des passerelles de transfert, ‚Ä¶<br>
Il se peut que certains protocoles soient √©galement incompatibles avec Kubernetes. Il vous faudra vous assurer que tout la galaxie de logiciels et syst√®mes gravitant autour de votre application sera compatible avec une telle architecture. Ceci n&rsquo;est pas une mince affaire. L&rsquo;aide d&rsquo;une √©quipe support (voir ci-dessus) vous sera d&rsquo;une grande utilit√©.</p>
<h2 id="pourquoi-sauter-le-pas-" class="headerLink">
    <a href="#pourquoi-sauter-le-pas-" class="header-mark"></a>2 Pourquoi sauter le pas ?</h2><h3 id="la-scalabilit√©-et-la-r√©sistance-√†-la-panne" class="headerLink">
    <a href="#la-scalabilit%c3%a9-et-la-r%c3%a9sistance-%c3%a0-la-panne" class="header-mark"></a>2.1 La scalabilit√© et la r√©sistance √† la panne</h3><p>Personnellement, la premi√®re fonctionnalit√© qui m&rsquo;a int√©ress√© c&rsquo;est la gestion de la scalabilit√©. Si vous avez des objectifs de 99.9% de disponibilit√©. Kubernetes sera une plus value ind√©niable dans votre architecture. Apr√®s quelques <s>jours</s> heures √† batailler avec les fichiers YAML, vous pourrez g√©rer automatiquement la scalabilit√© en fonction de plusieurs indicateurs qu&rsquo;ils soient techniques (ce sont les plus faciles √† g√©rer) ou un peu plus m√©tier <a href="https://www.metricfire.com/blog/prometheus-metrics-based-autoscaling-in-kubernetes/" target="_blank" rel="noopener noreferrer">en utilisant Prometheus</a> ‚Äì et oui encore une technologie suppl√©mentaire √† conna√Ætre.</p>
<p>En effet, au lieu de vous en soucier une fois arriv√© en production, vous aurez lors du d√©veloppement l&rsquo;obligation de prendre en consid√©ration l&rsquo;observabilit√© de votre application. Par exemple, vous aurez √† renseigner <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/" target="_blank" rel="noopener noreferrer">si votre application est pr√™te et/ou disponible pour traiter les requ√™tes</a>. Ces indicateurs vous permettront de scaler <strong>automatiquement</strong> et de re-cr√©er si n√©cessaire un <a href="https://kubernetes.io/docs/concepts/workloads/pods/" target="_blank" rel="noopener noreferrer">POD</a> en cas de panne.</p>
<p>J&rsquo;ai trouv√© que cette pratique √©tait vertueuse. Bien √©videmment, pas besoin d&rsquo;√™tre sur Kubernetes pour avoir de l&rsquo;observabilit√© dans des applications. Par contre, ici, c&rsquo;est obligatoire et impl√©ment√© d√®s le d√©veloppement.</p>
<p>La scalabilit√© automatique est aussi tr√®s int√©ressante. On a souvent vu des serveurs en production qui n&rsquo;√©taient pas suffisamment utilis√©s. Ici vous n&rsquo;aurez que les instances n√©cessaires pour votre cas d&rsquo;utilisation.<br>
La contrainte que l&rsquo;on peut voir √† cette fonctionnalit√© et qu&rsquo;on ne maitrise pas compl√®tement le nombre d&rsquo;instances disponibles. C&rsquo;est Kubernetes qui s&rsquo;en charge en prenant en compte le param√©trage que vous aurez renseign√© dans vos <a href="https://helm.sh/docs/chart_best_practices/templates/" target="_blank" rel="noopener noreferrer">templates HELM</a>.</p>
<h3 id="le-d√©ploiement" class="headerLink">
    <a href="#le-d%c3%a9ploiement" class="header-mark"></a>2.2 Le d√©ploiement</h3><p>Avant de d√©ployer (dans la vraie vie), vous aurez √† mettre en place un pipeline CI/CD qui orchestre les diff√©rents d√©ploiements sur tous vos environnements. Attention, ce n&rsquo;est pas une mince affaire üôÇ !</p>
<p>Une fois r√©alis√©, vous verrez automatiquement le gain. Vos d√©ploiements seront r√©ellement fluides. Bon OK, on peut le faire sur des <a href="https://en.wikipedia.org/wiki/Virtual_machine" target="_blank" rel="noopener noreferrer">VMS</a> standards. Mais on peut am√©liorer la proc√©dure de d√©ploiement pour mettre en place du <a href="https://dzone.com/articles/zero-downtime-deployment" target="_blank" rel="noopener noreferrer">zero downtime</a> pour ne pas interrompre le service lors d&rsquo;un d√©ploiement.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RollingUpdate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rollingUpdate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="linfrastructure-as-code" class="headerLink">
    <a href="#linfrastructure-as-code" class="header-mark"></a>2.3 L&rsquo;Infrastructure As Code</h3><div id="id-2"><figure><img
        
        loading="lazy"
        src="/assets/images/2020/10/jacek-dylag-nhcpop4a2xo-unsplash.png"
        srcset="/assets/images/2020/10/jacek-dylag-nhcpop4a2xo-unsplash.png, /assets/images/2020/10/jacek-dylag-nhcpop4a2xo-unsplash.png 1.5x, /assets/images/2020/10/jacek-dylag-nhcpop4a2xo-unsplash.png 2x"
        sizes="auto"
        alt="infrastructure as code"
        title="infrastructure as code" ></figure></div>
<p>Quand on pense √† Kubernetes, et au cloud, on ne pense pas trop √† l&rsquo;<a href="https://en.wikipedia.org/wiki/Infrastructure_as_code" target="_blank" rel="noopener noreferrer">Infrastructure As Code</a> au d√©but. Cependant, cette pratique est pour moi l&rsquo;une des plus utiles.</p>
<p>En effet, avoir votre syst√®me d√©crit dans des fichiers, versionn√©s vous permet de le tester d√®s le d√©veloppement. √áa √©vite ( dans la majorit√© des cas ) les erreurs lors des installations d&rsquo;environnement. La mise √† jour des logiciels est largement acc√©l√©r√©e.</p>
<p>Bien √©videmment, il existe <a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform</a> et <a href="https://www.ansible.com/" target="_blank" rel="noopener noreferrer">Ansible</a> pour le provisionning des environnements. Ici je trouve qu&rsquo;on pousse le concept encore plus loin. L&rsquo;automatisation est √† mon avis pouss√© √† paroxysme.<br>
Prenons par exemple la gestion des syst√®mes d&rsquo;exploitation. La mise √† jour sur des serveurs physiques ou virtuels peut prendre √©norm√©ment de temps et g√©n√©rer des erreurs. Avec de l&rsquo;infra as code, ceci est test√© et valid√© automatiquement via des tests unitaires d√®s l&rsquo;environnement de d√©veloppement.<br>
On peut suivre la gestion des environnements via un gestionnaire de sources et la promotion vers les autres environnements (recette[1-n], pr√©-production, production) est grandement acc√©l√©r√©e.</p>
<h2 id="conclusion" class="headerLink">
    <a href="#conclusion" class="header-mark"></a>3 Conclusion</h2><p>Bon, vous l&rsquo;aurez peut √™tre compris, cette galaxie de technologies est int√©ressante et peut vous aider dans vos projets. Avant d&rsquo;arriver √† l&rsquo;utiliser sereinement, il vous faudra sans doute d√©finir une trajectoire et appr√©hender plusieurs sujets avant d&rsquo;arriver √† d√©ployer vos applications sur un cloud interne ou externe.<br>
J&rsquo;esp√®re que cet article vous aura permis de mettre en √©vidence les pour et contre d&rsquo;une telle technologie et le cas √©ch√©ant vous donnera envie de franchir le pas.</p>
]]></description></item></channel></rss>