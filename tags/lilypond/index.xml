<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>lilypond - Tag - Alexandre Touret's Blog</title><link>http://blog.touret.info/tags/lilypond/</link><description>lilypond - Tag - Alexandre Touret's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>This work is licensed under a Creative Commons Attribution 4.0 International License.</copyright><lastBuildDate>Mon, 24 Aug 2020 12:42:46 +0200</lastBuildDate><atom:link href="http://blog.touret.info/tags/lilypond/" rel="self" type="application/rss+xml"/><item><title>Music Scores As Code</title><link>http://blog.touret.info/2020/08/24/music-scores-as-code/</link><pubDate>Mon, 24 Aug 2020 12:42:46 +0200</pubDate><author><name>Alexandre Touret</name></author><guid>http://blog.touret.info/2020/08/24/music-scores-as-code/</guid><description><![CDATA[<div class="featured-image">
                <img src="/assets/images/2020/08/cesar-abner-martinez-aguilar-_lmekwwtiwy-unsplash.jpg" referrerpolicy="no-referrer">
            </div><p>Derri√®re ce nom pompeux qui peut effrayer, je vais essayer d&rsquo;expliquer dans cet article comment on peut versionner facilement ses partitions et les publier sur le web.</p>
<p>En cherchant comment mettre de la documentation technique avec des diagrammes <a href="https://plantuml.com/" target="_blank" rel="noopener noreferrer">PlantUml</a> dans des repos <a href="https://about.gitlab.com/" target="_blank" rel="noopener noreferrer">GITLAB</a> et g√©n√©r√©s avec des pipelines, je me suis mis dans la t√™te de faire la m√™me chose avec des partitions üôÇ</p>
<p>Depuis plusieurs ann√©es, j&rsquo;utilise <a href="https://lilypond.org/" target="_blank" rel="noopener noreferrer">lilypond</a> pour cr√©er mes partitions. C&rsquo;est un peu difficile de s&rsquo;y mettre, mais une fois la syntaxe assimil√©e, la saisie d&rsquo;une partition est beaucoup plus efficace. Le rendu des partitions est vraiment optimis√©.<br>
Si vous voulez plus de d√©tails sur le pourquoi du comment je vous conseille <a href="https://lilypond.org/doc/v2.19/Documentation/essay-big-page" target="_blank" rel="noopener noreferrer">cette page</a>.</p>
<p>Vous trouverez des exemples sur <a href="https://lilypond.org/text-input.fr.html" target="_blank" rel="noopener noreferrer">le site</a>.</p>
<p>J&rsquo;ai donc eu l&rsquo;id√©e de:</p>
<ul>
<li>Stocker ces partitions sur un repo github (<em>jusque l√† rien d&rsquo;exceptionnel</em>)</li>
<li>G√©n√©rer automatiquement les partitions au format PDF, PNG et MIDI via une <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer">github action</a> (<em>√ßa commence √† devenir int√©ressant‚Ä¶</em>)</li>
<li>Les publier avec <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">les github pages</a> (<em>tant qu&rsquo;√† faire üôÇ</em>)</li>
</ul>
<h2 id="stockage" class="headerLink">
    <a href="#stockage" class="header-mark"></a>1 Stockage</h2><p>Pourquoi stocker dans un r√©f√©rentiel de sources tel que Github ? Pour les non informaticiens : les partitions sont stock√©es au format texte.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-latex" data-lang="latex"><span class="line"><span class="cl"><span class="k">\version</span> &#34;2.12.1&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">\header</span> <span class="nb">{</span>
</span></span><span class="line"><span class="cl">  title=&#34;Try a little tenderness&#34;
</span></span><span class="line"><span class="cl">  composer=&#34;Harry Woods, Jimmy Campbell <span class="nb">&amp;</span> Reg Connely&#34;
</span></span><span class="line"><span class="cl">  subtitle = &#34;Commitments Version&#34;
</span></span><span class="line"><span class="cl">  <span class="c">%poet = &#34;Poete&#34;
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  instrument = &#34;Piano&#34;
</span></span><span class="line"><span class="cl">  editor = &#34;L&#39;√©diteur&#34;
</span></span><span class="line"><span class="cl">  <span class="c">%meter=\markup {\bold {&#34;Remarque sur le rhythme&#34;}}
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  style = &#34;Soul&#34;
</span></span><span class="line"><span class="cl">  maintainer = &#34;Alexandre Touret&#34;
</span></span><span class="line"><span class="cl">  maintainerEmail = &#34;alexandre.touret@free.fr&#34;
</span></span><span class="line"><span class="cl">  maintainerWeb = &#34;http://blog.touret.info&#34;     
</span></span><span class="line"><span class="cl">  lastupdated = &#34;&#34;
</span></span><span class="line"><span class="cl">  source = &#34;Music room&#34;
</span></span><span class="line"><span class="cl">  footer = &#34;Footer&#34;
</span></span><span class="line"><span class="cl">  copyright =<span class="k">\markup</span> <span class="nb">{</span><span class="k">\fontsize</span> #-1.5
</span></span><span class="line"><span class="cl"> &#34;Delivered by A TOURET&#34;<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">}</span>
</span></span><span class="line"><span class="cl">upper=
</span></span><span class="line"><span class="cl"><span class="k">\relative</span> c&#39;<span class="nb">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">\clef</span> treble
</span></span><span class="line"><span class="cl">  <span class="k">\time</span> 4/4
</span></span><span class="line"><span class="cl">  <span class="k">\tempo</span> 4=176
</span></span><span class="line"><span class="cl">  <span class="k">\key</span> g <span class="k">\major</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  d&#39;2 (b4 e
</span></span><span class="line"><span class="cl">  d2 b4 a 
</span></span><span class="line"><span class="cl">  g2 g2 
</span></span><span class="line"><span class="cl">  &lt;e g,&gt;2) &lt;fis, c&#39; d&gt; 
</span></span><span class="line"><span class="cl">  <span class="k">\bar</span> &#34;||&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://git-scm.com/" target="_blank" rel="noopener noreferrer">GIT</a> et <a href="https://github.com" target="_blank" rel="noopener noreferrer">GITHUB</a> permettent de versionner facilement et pouvoir faire facilement un retour arri√®re en cas d&rsquo;erreur.<br>
Aussi, GITHUB offre des <a href="https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-requests" target="_blank" rel="noopener noreferrer">fonctionnalit√©s ¬´¬†sociales¬†¬ª et collaboratives qui facilitent la revue des modifications</a> ( en cas de travail √† plusieurs ).<br>
Bref, √ßa offre la s√©curit√© d&rsquo;une sauvegarde et la possibilit√© d&rsquo;un retour arri√®re en cas d&rsquo;erreur.</p>
<h2 id="g√©n√©rer-les-partitions-avec-une-github-action" class="headerLink">
    <a href="#g%c3%a9n%c3%a9rer-les-partitions-avec-une-github-action" class="header-mark"></a>2 G√©n√©rer les partitions avec une github action</h2><p>Les <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer">github actions</a> sont des outils permettant:</p>
<blockquote class="wp-block-quote">
  <p>
    GitHub Actions makes it easy to automate all your software workflows, now with world-class CI/CD. Build, test, and deploy your code right from GitHub. Make code reviews, branch management, and issue triaging work the way you want.
  </p>
</blockquote>
<p>J&rsquo;ai donc d√©cid√© de cr√©er un workflow qui permet de g√©n√©rer les partitions au format lilypond.</p>
<p>J&rsquo;ai mis √† disposition <a href="https://github.com/alexandre-touret/lilypond-github-action" target="_blank" rel="noopener noreferrer">le code sur github</a> sous <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener noreferrer">licence GNU GPLv3</a>. Elle est utilisable telle quelle.</p>
<p>Pour cr√©er l&rsquo;action, il faut cr√©er un fichier action.yml √† la racine du repo. Voici le contenu</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nl">name:</span> <span class="err">&#39;</span><span class="n">Lilypond</span> <span class="n">Generator</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nl">description:</span> <span class="err">&#39;</span><span class="n">Run</span> <span class="n">Lilypond</span> <span class="n">tool</span> <span class="n">with</span> <span class="n">the</span> <span class="n">given</span> <span class="n">set</span> <span class="n">of</span> <span class="n">arguments</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">music</span> <span class="n">sheets</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nl">author:</span> <span class="err">&#39;</span><span class="nd">@alexandre</span><span class="o">-</span><span class="n">touret</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nl">
</span></span></span><span class="line"><span class="cl"><span class="nl">inputs:</span>
</span></span><span class="line"><span class="cl">  <span class="n">args</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">Arguments</span> <span class="k">for</span> <span class="n">Lilyponid</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">required</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="o">:</span> <span class="err">&#39;</span><span class="o">-</span><span class="n">h</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nl">
</span></span></span><span class="line"><span class="cl"><span class="nl">runs:</span>
</span></span><span class="line"><span class="cl">    <span class="n">using</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">docker</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">Dockerfile</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="o">-</span> <span class="n">$</span><span class="o">{{</span> <span class="n">inputs</span><span class="o">.</span><span class="na">args</span> <span class="o">}}</span>
</span></span><span class="line"><span class="cl"><span class="nl">
</span></span></span><span class="line"><span class="cl"><span class="nl">branding:</span>
</span></span><span class="line"><span class="cl">  <span class="n">icon</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">underline</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="n">color</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">blue</span><span class="err">&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Vous aurez compris que ce fichier fait r√©f√©rence √† une <a href="https://github.com/alexandre-touret/lilypond-github-action/blob/master/Dockerfile" target="_blank" rel="noopener noreferrer">image Docker</a>. Cette derni√®re n&rsquo;est ni plus ni moins qu&rsquo;une Debian avec lilypond d&rsquo;install√©.</p>
<p>Pour l&rsquo;utiliser dans un repo github, on peut cr√©er une action qui l&rsquo;utilise. Voici un exemple:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nl">jobs:</span>
</span></span><span class="line"><span class="cl">  <span class="n">build_sheets</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">runs</span><span class="o">-</span><span class="n">on</span><span class="o">:</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">latest</span>
</span></span><span class="line"><span class="cl">    <span class="n">env</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">LILYPOND_FILES</span><span class="o">:</span> <span class="s">&#34;*.ly&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">steps</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">Checkout</span> <span class="n">Source</span> 
</span></span><span class="line"><span class="cl">        <span class="n">uses</span><span class="o">:</span> <span class="n">actions</span><span class="o">/</span><span class="n">checkout</span><span class="nd">@v1</span>
</span></span><span class="line"><span class="cl">      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">Get</span> <span class="n">changed</span> <span class="n">files</span>
</span></span><span class="line"><span class="cl">        <span class="n">id</span><span class="o">:</span> <span class="n">getfile</span>
</span></span><span class="line"><span class="cl">        <span class="n">run</span><span class="o">:</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">          <span class="n">echo</span> <span class="s">&#34;::set-output name=files::$(find ${{github.workspace}} -name &#34;</span><span class="n">$</span><span class="o">{{</span> <span class="n">env</span><span class="o">.</span><span class="na">LILYPOND_FILES</span> <span class="o">}}</span><span class="s">&#34; -printf &#34;</span><span class="o">%</span><span class="n">P</span><span class="err">\</span><span class="n">n</span><span class="s">&#34; | xargs)&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">LILYPOND</span> <span class="n">files</span> <span class="n">considered</span> <span class="n">echo</span> <span class="n">output</span>
</span></span><span class="line"><span class="cl">        <span class="n">run</span><span class="o">:</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">          <span class="n">echo</span> <span class="n">$</span><span class="o">{{</span> <span class="n">steps</span><span class="o">.</span><span class="na">getfile</span><span class="o">.</span><span class="na">outputs</span><span class="o">.</span><span class="na">files</span> <span class="o">}}</span>
</span></span><span class="line"><span class="cl">      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">Generate</span> <span class="n">PDF</span> <span class="n">music</span> <span class="n">sheets</span>
</span></span><span class="line"><span class="cl">        <span class="n">uses</span><span class="o">:</span> <span class="n">alexandre</span><span class="o">-</span><span class="n">touret</span><span class="o">/</span><span class="n">lilypond</span><span class="o">-</span><span class="n">github</span><span class="o">-</span><span class="n">action</span><span class="nd">@master</span>
</span></span><span class="line"><span class="cl">        <span class="n">with</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">args</span><span class="o">:</span> <span class="o">-</span><span class="n">V</span> <span class="o">-</span><span class="n">f</span> <span class="o">--</span><span class="n">pdf</span> <span class="n">$</span><span class="o">{{</span> <span class="n">steps</span><span class="o">.</span><span class="na">getfile</span><span class="o">.</span><span class="na">outputs</span><span class="o">.</span><span class="na">files</span> <span class="o">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>A la derni√®re ligne on peut passer <a href="http://lilypond.org/doc/v2.18/Documentation/usage/command_002dline-usage" target="_blank" rel="noopener noreferrer">les arguments n√©cessaires √† lilypond</a>.</p>
<h2 id="publication" class="headerLink">
    <a href="#publication" class="header-mark"></a>3 Publication</h2><p>La c&rsquo;est l&rsquo;√©tape la plus facile :). Il suffit d&rsquo;activer <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">les github pages</a> et de commiter et pusher les partitions g√©n√©r√©es</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">Push</span> <span class="n">Local</span> <span class="n">Changes</span>
</span></span><span class="line"><span class="cl">        <span class="n">run</span><span class="o">:</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">          <span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">local</span> <span class="n">user</span><span class="o">.</span><span class="na">email</span> <span class="s">&#34;${{ secrets.GIT_USERNAME }}&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">local</span> <span class="n">user</span><span class="o">.</span><span class="na">name</span> <span class="s">&#34;${{ secrets.GIT_EMAIL }}&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="n">git</span> <span class="n">add</span> <span class="o">.</span>
</span></span><span class="line"><span class="cl">          <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s">&#34;Add changes&#34;</span> <span class="o">-</span><span class="n">a</span>
</span></span><span class="line"><span class="cl">      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">Push</span> <span class="n">changes</span>
</span></span><span class="line"><span class="cl">        <span class="n">uses</span><span class="o">:</span> <span class="n">ad</span><span class="o">-</span><span class="n">m</span><span class="o">/</span><span class="n">github</span><span class="o">-</span><span class="n">push</span><span class="o">-</span><span class="n">action</span><span class="nd">@master</span>
</span></span><span class="line"><span class="cl">        <span class="n">with</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">          <span class="n">github_token</span><span class="o">:</span> <span class="n">$</span><span class="o">{{</span> <span class="n">secrets</span><span class="o">.</span><span class="na">GITHUB_TOKEN</span> <span class="o">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Il suffit de cr√©er une page index.md √† la racine et d&rsquo;ajouter des liens vers les partitions g√©n√©r√©es ( dans mon cas, √ßa se passe dans le r√©pertoire /docs ).<br>
Vous pouvez trouver un exemple <a href="https://alexandre-touret.github.io/piano-sheets-as-code/" target="_blank" rel="noopener noreferrer">ici</a>.</p>
<h2 id="conclusion" class="headerLink">
    <a href="#conclusion" class="header-mark"></a>4 Conclusion</h2><p>Voila comment on peut g√©n√©rer un site avec des partitions cr√©es avec Lilypond.<br>
Vous trouverez les diff√©rents liens ci-dessous. Peut √™tre que je publierai cette action sur le marketplace une fois que j&rsquo;aurai publi√© une documentation digne de ce nom :).</p>
<ul>
<li><a href="https://github.com/alexandre-touret/lilypond-github-action" target="_blank" rel="noopener noreferrer">Action</a></li>
<li><a href="https://github.com/alexandre-touret/piano-sheets-as-code" target="_blank" rel="noopener noreferrer">Exemple d&rsquo;utilisation</a></li>
<li><a href="https://alexandre-touret.github.io/piano-sheets-as-code/" target="_blank" rel="noopener noreferrer">Exemple de site g√©n√©r√©</a></li>
</ul>
]]></description></item></channel></rss>